# https://github.com/getredash/redash/blob/v7.0.0/setup/docker-compose.yml
version: '3'
services:
  server:
    image: redash/redash:7.0.0.b18042
    command: server
    ports:
      - "5000:5000"
    # depends_on:
    #   - postgres
    #   - redis
    environment:
      # REDASH_WEB_WORKERS: 4
      REDASH_WEB_WORKERS: 1
      PYTHONUNBUFFERED: 0
      REDASH_LOG_LEVEL: "INFO"
      REDASH_REDIS_URL: "redis://redis:6379/0"
      # POSTGRES_PASSWORD:
      REDASH_COOKIE_SECRET: "FIXME"
      REDASH_SECRET_KEY: "FIXME"
      REDASH_DATABASE_URL: "postgresql://redash:${POSTGRES_PASSWORD}@postgres/redash"
    logging:
      driver: awslogs
      options:
        awslogs-group: /ecs/dev-fargate/redash
        awslogs-region: ap-northeast-1
        awslogs-stream-prefix: ecs
  # scheduler:
  #   <<: *redash-service
  #   command: scheduler
  #   environment:
  #     QUEUES: "celery"
  #     WORKERS_COUNT: 1
  # scheduled_worker:
  #   <<: *redash-service
  #   command: worker
  #   environment:
  #     QUEUES: "scheduled_queries,schemas"
  #     WORKERS_COUNT: 1
  # adhoc_worker:
  #   <<: *redash-service
  #   command: worker
  #   environment:
  #     QUEUES: "queries"
  #     WORKERS_COUNT: 2
  # redis:
  #   image: redis:3.0-alpine
  # postgres:
  #   image: postgres:9.5.6-alpine
  #   environment:
  #     POSTGRES_PASSWORD:
  #     POSTGRES_USER: "redash"
  #     POSTGRES_DB: "redash"
